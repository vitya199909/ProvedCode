{
  "dashboard": {
    "title": "Capacity Planning & Resource Usage",
    "tags": ["capacity", "resources", "planning"],
    "timezone": "browser",
    "panels": [
      {
        "title": "CPU Usage Trend (7 days)",
        "type": "timeseries",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
            "legendFormat": "CPU Usage %",
            "refId": "A"
          },
          {
            "expr": "80",
            "legendFormat": "Warning Threshold (80%)",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 70, "color": "yellow"},
                {"value": 80, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "title": "Memory Usage Trend",
        "type": "timeseries",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "targets": [
          {
            "expr": "100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))",
            "legendFormat": "Memory Usage %",
            "refId": "A"
          },
          {
            "expr": "85",
            "legendFormat": "Warning Threshold (85%)",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 80, "color": "yellow"},
                {"value": 85, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "title": "Disk Usage by Mount Point",
        "type": "bargauge",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "targets": [
          {
            "expr": "100 - ((node_filesystem_avail_bytes{mountpoint=\"/\",fstype!=\"rootfs\"} * 100) / node_filesystem_size_bytes{mountpoint=\"/\",fstype!=\"rootfs\"})",
            "legendFormat": "Root / - {{instance}}",
            "refId": "A"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 80, "color": "yellow"},
                {"value": 90, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "title": "Network Traffic (Incoming/Outgoing)",
        "type": "timeseries",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
        "targets": [
          {
            "expr": "rate(node_network_receive_bytes_total{device!=\"lo\"}[5m])",
            "legendFormat": "Receive {{device}}",
            "refId": "A"
          },
          {
            "expr": "rate(node_network_transmit_bytes_total{device!=\"lo\"}[5m])",
            "legendFormat": "Transmit {{device}}",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "Bps"
          }
        }
      },
      {
        "title": "Backend Instances - Request Rate",
        "type": "timeseries",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "targets": [
          {
            "expr": "sum by (instance) (rate(http_server_requests_seconds_count{job=\"spring-boot-backend\"}[5m]))",
            "legendFormat": "{{instance}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "reqps"
          }
        }
      },
      {
        "title": "Backend JVM Memory Usage",
        "type": "timeseries",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "targets": [
          {
            "expr": "sum by (instance) (jvm_memory_used_bytes{job=\"spring-boot-backend\",area=\"heap\"})",
            "legendFormat": "{{instance}} - Heap Used",
            "refId": "A"
          },
          {
            "expr": "sum by (instance) (jvm_memory_max_bytes{job=\"spring-boot-backend\",area=\"heap\"})",
            "legendFormat": "{{instance}} - Heap Max",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes"
          }
        }
      },
      {
        "title": "Database Connections",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 24},
        "targets": [
          {
            "expr": "sum(hikaricp_connections_active)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 8, "color": "yellow"},
                {"value": 10, "color": "red"}
              ]
            }
          }
        },
        "options": {
          "colorMode": "background"
        }
      },
      {
        "title": "Nginx Active Connections",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 24},
        "targets": [
          {
            "expr": "nginx_connections_active",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          }
        },
        "options": {
          "colorMode": "value"
        }
      },
      {
        "title": "System Load Average (1m)",
        "type": "gauge",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 24},
        "targets": [
          {
            "expr": "node_load1",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 4,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 2, "color": "yellow"},
                {"value": 3, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "title": "Container Count",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 24},
        "targets": [
          {
            "expr": "count(up{job=\"spring-boot-backend\"})",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "none",
          "textMode": "value_and_name"
        }
      }
    ],
    "refresh": "30s",
    "time": {
      "from": "now-7d",
      "to": "now"
    }
  },
  "overwrite": true
}
