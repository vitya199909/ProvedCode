# Monitoring Stack –¥–ª—è ProvedCode

–°—Ç–µ–∫ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤–∫–ª—é—á–∞—î Prometheus, Grafana, PostgreSQL Exporter, Nginx Exporter —Ç–∞ Loki –¥–ª—è –ª–æ–≥—ñ–≤.

## –ó–∞–ø—É—Å–∫

1. –°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø—É—Å—Ç—ñ—Ç—å –æ—Å–Ω–æ–≤–Ω–∏–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫:
```bash
cd ../App_Docker_Compose
docker-compose up -d
```

2. –ü–æ—Ç—ñ–º –∑–∞–ø—É—Å—Ç—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:
```bash
cd ../Monitoring_Docker_Compose
docker-compose up -d
```

## –î–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤—ñ—Å—ñ–≤

- **Grafana**: http://localhost:9091
  - –õ–æ–≥—ñ–Ω: `admin`
  - –ü–∞—Ä–æ–ª—å: `admin`

- **Prometheus**: http://localhost:9090

- **Loki**: http://localhost:3100 (API –¥–ª—è –ª–æ–≥—ñ–≤)

## –©–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å—Å—è

### Spring Boot Backend
- HTTP –º–µ—Ç—Ä–∏–∫–∏ (–∑–∞–ø–∏—Ç–∏, –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –∑–∞—Ç—Ä–∏–º–∫–∏)
- JVM –º–µ—Ç—Ä–∏–∫–∏ (–ø–∞–º'—è—Ç—å, garbage collection, –ø–æ—Ç–æ–∫–∏)
- –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É (custom metrics)

### Nginx Frontend
- HTTP –∑–∞–ø–∏—Ç–∏ (–∫—ñ–ª—å–∫—ñ—Å—Ç—å, —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∏)
- Active connections
- Requests per second
- Upstream backends —Å—Ç–∞—Ç—É—Å

### PostgreSQL
- –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ –ë–î
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
- –†–æ–∑–º—ñ—Ä –ë–î —Ç–∞ —Ç–∞–±–ª–∏—Ü—å
- –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤

### Prometheus
- –°–∞–º–æ-–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Prometheus

### System (Node Exporter)
- CPU usage —ñ load average
- Memory —ñ swap
- Disk space —ñ I/O
- Network traffic
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —ñ sensors

## –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è (Loki)

### –©–æ –∑–±–∏—Ä–∞—î—Ç—å—Å—è:
- **Backend logs** - Spring Boot application logs (–≤—Å—ñ 3 —ñ–Ω—Å—Ç–∞–Ω—Å–∏)
- **Frontend logs** - Nginx access —Ç–∞ error logs
- **Database logs** - PostgreSQL logs
- **Docker logs** - stdout/stderr –∑ —É—Å—ñ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
- **System logs** - Syslog, Auth.log, kern.log —Ç–∞ —ñ–Ω—à—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –ª–æ–≥–∏ –∑ /var/log

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ª–æ–≥—ñ–≤ —É Grafana:
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Grafana ‚Üí Explore
2. –í–∏–±–µ—Ä—ñ—Ç—å datasource **Loki**
3. –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤:
   ```logql
   # –í—Å—ñ –ª–æ–≥–∏ backend
   {compose_service="backend1"}
   
   # –õ–æ–≥–∏ –∑ –ø–æ–º–∏–ª–∫–∞–º–∏
   {compose_service=~"backend.*"} |= "ERROR"
   
   # Nginx access logs
   {compose_service="frontend"} |= "GET"
   
   # –õ–æ–≥–∏ PostgreSQL
   {compose_service="db"}
   
   # –ó–∞ –æ—Å—Ç–∞–Ω–Ω—é –≥–æ–¥–∏–Ω—É –∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º
   {compose_service="backend1"} |= "Exception" [1h]
   
   # –°–∏—Å—Ç–µ–º–Ω—ñ –ª–æ–≥–∏ (syslog)
   {job="syslog"}
   
   # –õ–æ–≥–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
   {job="auth"} |= "Failed password"
   
   # –í—Å—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
   {job="varlogs"}
   ```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–∞—à–±–æ—Ä–¥—ñ–≤ Grafana

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Grafana (http://localhost:9091)
2. –Ü–º–ø–æ—Ä—Ç—É–π—Ç–µ –≥–æ—Ç–æ–≤—ñ –¥–∞—à–±–æ—Ä–¥–∏:
   - **Spring Boot Dashboard**: ID `12900` (Spring Boot 2.1+ Statistics)
   - **PostgreSQL Dashboard**: ID `9628`
   - **Nginx Dashboard**: ID `12708` (NGINX Prometheus Exporter)
   - **Logs Dashboard**: –≤–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ "ProvedCode Logs"
   - **Capacity Planning**: –≤–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ "Capacity Planning & Resource Usage"
   - **Node Exporter**: ID `1860` (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–∏—Å—Ç–µ–º–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥)

### –Ø–∫ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∏ –∑ Grafana.com:
1. –£ Grafana –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "+" ‚Üí "Import dashboard"
2. –í–≤–µ–¥—ñ—Ç—å ID –¥–∞—à–±–æ—Ä–¥–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `12900`)
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Load"
4. –í–∏–±–µ—Ä—ñ—Ç—å datasource: **Prometheus**
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Import"

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö –¥–∞—à–±–æ—Ä–¥—ñ–≤:
1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "+" ‚Üí "Create Dashboard"
2. "Add visualization" ‚Üí –≤–∏–±–µ—Ä—ñ—Ç—å datasource (Prometheus –∞–±–æ Loki)
3. –î–ª—è –º–µ—Ç—Ä–∏–∫ (Prometheus) - –≤–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç —Ç–∏–ø—É `system_cpu_usage`
4. –î–ª—è –ª–æ–≥—ñ–≤ (Loki) - –≤–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç —Ç–∏–ø—É `{compose_service="backend1"}`
5. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ –∑–±–µ—Ä–µ–∂—ñ—Ç—å –ø–∞–Ω–µ–ª—å

---

## üìà Capacity Planning —ñ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

–î–∞—à–±–æ—Ä–¥ **"Capacity Planning & Resource Usage"** –ø–æ–∫–∞–∑—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —ñ –¥–æ–ø–æ–º–∞–≥–∞—î –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏.

### ‚ö†Ô∏è –ö–æ–ª–∏ —Ç—Ä–µ–±–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏?

**–ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ—Ä–æ–≥–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:**

| –ú–µ—Ç—Ä–∏–∫–∞ | Warning | Critical | –î—ñ—è |
|---------|---------|----------|-----|
| CPU | > 70% | > 80% | –î–æ–¥–∞—Ç–∏ backend —ñ–Ω—Å—Ç–∞–Ω—Å–∏ –∞–±–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–¥ |
| Memory | > 80% | > 85% | –ó–±—ñ–ª—å—à–∏—Ç–∏ RAM –∞–±–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ |
| Disk | > 80% | > 90% | –†–æ–∑—à–∏—Ä–∏—Ç–∏ volume –∞–±–æ –æ—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ |
| DB Connections | > 7/10 | > 9/10 | –ó–±—ñ–ª—å—à–∏—Ç–∏ –ø—É–ª –∞–±–æ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ |
| Request rate | –ó—Ä–æ—Å—Ç–∞—î | –ü–æ—Å—Ç—ñ–π–Ω–æ –≤–∏—Å–æ–∫–∏–π | Horizontal scaling |

### üîÑ –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

**1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (–¥–æ–¥–∞—Ç–∏ —ñ–Ω—Å—Ç–∞–Ω—Å–∏):**
```bash
# –î–æ–¥–∞—Ç–∏ 4-–π backend —ñ–Ω—Å—Ç–∞–Ω—Å
cd /home/viktor/ProvedCode/App_Docker_Compose
# –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ docker-compose.yml - –¥–æ–¥–∞—Ç–∏ backend4
docker compose up -d
```

**2. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (–±—ñ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å—ñ–≤):**
```yaml
# –£ docker-compose.yml
services:
  backend1:
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
```

**3. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±–µ–∑ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è:**
- **JVM tuning**: `-Xmx1g -XX:+UseG1GC`
- **Connection pooling**: –∑–±—ñ–ª—å—à–∏—Ç–∏ `spring.datasource.hikari.maximum-pool-size=20`
- **Caching**: –¥–æ–¥–∞—Ç–∏ Redis –¥–ª—è —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- **CDN**: –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ frontend
- **Database indexing**: –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏

### üìä –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–∞—à–±–æ—Ä–¥

–î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—É—î **—Ç—Ä–µ–Ω–¥–∏ –∑–∞ 7 –¥–Ω—ñ–≤**:
- –ß–∏ –∑—Ä–æ—Å—Ç–∞—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ —á–∞—Å–æ–º?
- –ß–∏ —î –ø—ñ–∫–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ –ø–µ–≤–Ω–∏–π —á–∞—Å?
- –°–∫—ñ–ª—å–∫–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –¥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è?

**–ö–æ–ª—å–æ—Ä–æ–≤–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è:**
- üü¢ –ó–µ–ª–µ–Ω–∏–π (<70% CPU, <80% Memory): –≤—Å–µ –û–ö
- üü° –ñ–æ–≤—Ç–∏–π (70-80% CPU, 80-85% Memory): —Ç—Ä–µ–±–∞ –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- üî¥ –ß–µ—Ä–≤–æ–Ω–∏–π (>80% CPU, >85% Memory): —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ —Ç—Ä–µ–±–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏

üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: [CAPACITY_PLANNING.md](./CAPACITY_PLANNING.md)

---
